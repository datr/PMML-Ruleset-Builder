<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PMML RuleSet Builder</title>

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

  	<!-- Optional theme -->
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="./QueryBuilder/query-builder.min.css">

    <link rel="stylesheet" href="./prettify.css">

  	<style type="text/css">
  	  body {
   	    padding-top: 50px;
      }
      .starter-template {
        padding: 40px 15px;
      }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body onload="prettyPrint()">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">PMML RuleSet Builder</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#dictionary">Dictionary</a></li>
            <li><a href="#transforms">Transforms</a></li>
            <li><a href="#rules">Rules</a></li>
            <li><a href="#pmml">PMML</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">

      <div class="starter-template">
        <h1>Data Dictionary</h1>

        <table class="table table-striped">
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Operation Type</th>
              <th>Data Type</th>
              <th>Controls</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" name="dictionary[][name]" class="form-control" /></td>
              <td><select class="form-control" name="dictionary[][optype]">
                <option value="categorical">Categorical</option>
                <option value="ordinal">Ordinal</option>
                <option value="continuous">Continuous</option>
              </select></td>
              <td><select class="form-control" name="dictionary[][datatype]">
                <option value="string">String</option>
                <option value="integer">Integer</option>
                <option value="float">Float</option>
                <option value="double">Double</option>
                <option value="boolean">Boolean</option>
                <option value="date">Date</option>
                <option value="time">Time</option>
                <option value="dateTime">DateTime</option>
                <option value="dateDaysSince[0]">Days Since 0</option>
                <option value="dateDaysSince[1960]">Days Since 1960</option>
                <option value="dateDaysSince[1970]">Days Since 1970</option>
                <option value="dateDaysSince[1980]">Days Since 1980</option>
                <option value="timeSeconds">Seconds Since Midnight</option>
                <option value="dateTimeSecondsSince[0]">Seconds Since 0</option>
                <option value="dateTimeSecondsSince[1960]">Seconds Since 1960</option>
                <option value="dateTimeSecondsSince[1970]">Seconds Since 1970</option>
                <option value="dateTimeSecondsSince[1980]">Seconds Since 1980</option>
              </select></td>
              <td>
                <button type="button" class="btn btn-success btn-xs adddictionaryrow"><span class="glyphicon glyphicon-plus"></span></button>
                <button type="button" class="btn btn-danger btn-xs removerow"><span class="glyphicon glyphicon-minus"></span></button>
              </td>
            </tr>
          </tbody>
        </table>

        <h1>Transformation Dictionary and Derived Fields</h1>

        <table class="table table-striped">
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Operation Type</th>
              <th>Data Type</th>
              <th>Expression</th>
              <th>Controls</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" name="transforms[][name]" class="form-control" /></td>
              <td><select class="form-control" name="transforms[][optype]">
                <option value="categorical">Categorical</option>
                <option value="ordinal">Ordinal</option>
                <option value="continuous">Continuous</option>
              </select></td>
              <td><select class="form-control" name="transforms[][datatype]">
                <option value="string">String</option>
                <option value="integer">Integer</option>
                <option value="float">Float</option>
                <option value="double">Double</option>
                <option value="boolean">Boolean</option>
                <option value="date">Date</option>
                <option value="time">Time</option>
                <option value="dateTime">DateTime</option>
                <option value="dateDaysSince[0]">Days Since 0</option>
                <option value="dateDaysSince[1960]">Days Since 1960</option>
                <option value="dateDaysSince[1970]">Days Since 1970</option>
                <option value="dateDaysSince[1980]">Days Since 1980</option>
                <option value="timeSeconds">Seconds Since Midnight</option>
                <option value="dateTimeSecondsSince[0]">Seconds Since 0</option>
                <option value="dateTimeSecondsSince[1960]">Seconds Since 1960</option>
                <option value="dateTimeSecondsSince[1970]">Seconds Since 1970</option>
                <option value="dateTimeSecondsSince[1980]">Seconds Since 1980</option>
              </select></td>
              <td>
                <textarea name="transforms[][expression]" class="form-control" rows="3"></textarea>
              </td>
              <td>
                <button type="button" class="btn btn-success btn-xs addtransformrow"><span class="glyphicon glyphicon-plus"></span></button>
                <button type="button" class="btn btn-danger btn-xs removerow"><span class="glyphicon glyphicon-minus"></span></button>
              </td>
            </tr>
          </tbody>
        </table>

        <h1>Rules</h1>

        <h2>Configuration</h2>

          <div class="form-group">
            <label for="modelName">Model name</label>
            <input name="modelName" type="text" class="form-control">
            <p class="help-block">
              The value in modelName in a RuleSetModel element identifies the
              model with an unique name in the context of the PMML file.
            </p>
          </div>

          <div class="form-group">
            <label for="defaultScore">Default score</label>
            <input name="defaultScore" type="text" class="form-control">
            <p class="help-block">
               The value of score in a RuleSet serves as the default predicted
               value when scoring a case no rules in the ruleset fire.
            </p>
          </div>

          <div class="form-group">
            <label for="defaultConfidence">Default confidence</label>
            <input name="defaultConfidence" type="text" class="form-control">
            <p class="help-block">
              Provides a confidence to be returned with the default score (when
              scoring a case and no rules in the ruleset fire).
            </p>
          </div>

        <h2>Rule Selection Method</h2>

        <p>
          Specifies how to select rules from the ruleset to score a new case. If
          more than one method is included, the first method is used as the
          default method for scoring, but the other methods included may be
          selected by the application wishing to perform scoring as valid
          alternative methods. 
        </p>

        <p>
          <strong>Criterion</strong> explains how to determine and rank
          predictions and their associated confidences from the ruleset in
          case multiple rules fire. There are many many possible ways of
          applying rulesets, but three useful approaches are covered.
        </p>

        <ul class="sortable list-group">
          <li class="list-group-item">
            <div class="checkbox">
              <label>
                <input type="checkbox" name="criterion[]" value="firstHit" checked="checked">
                <h4 class="list-group-item-heading">First Hit</h4>
              </label>
              <p class="list-group-item-text">
                First firing rule is chosen as the predicted class, and the
                confidence is the weight of that rule. If further predictions
                and confidences are required, a search for the next firing rule
                that chooses a different predicted class is made, and so on.
              </p>
            </div>
          </li>
          <li class="list-group-item">
            <div class="checkbox">
              <label>
                <input type="checkbox" name="criterion[]" value="weightedSum">
                <h4 class="list-group-item-heading">Weighted Sum</h4>
              </label>
              <p class="list-group-item-text">
                Calculate the total weight for each class by summing the weights
                for each firing rule which predicts that class. The prediction
                with the highest total weight is then selected. The confidence
                is the total weight of the winning class divided by the number
                of firing rules. If further predictions and confidences are
                required, the process is repeated to find the class with the
                second highest total weight, and so on. Note that if two or more
                classes are assigned the same weight, the winning class is the
                one that appears first in the data dictionary values.
              </p>
            </div>
          </li>
          <li class="list-group-item">
            <div class="checkbox">
              <label>
                <input type="checkbox" name="criterion[]" value="weightedMax">
                <h4 class="list-group-item-heading">Weighted Max</h4>
              </label>
              <p class="list-group-item-text">
                Select the firing rule with the highest weight. The confidence
                returned is the confidence of the selected rule. Note that if
                two firing rules have the same weight, the rule that occurs
                first in the ruleset is chosen.
              </p>
            </div>
          </li>
        </ul>

        <h2>Rules</h2>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Rule</h3>
          </div>
          <div class="panel-body">

        <div class="row">
          <div class="col-md-4 form-group">
            <label for="modelName">Score</label>
            <input name="rules[][score]" type="text" class="form-control">
            <p class="help-block">
              The predicted value when the rule fires.
            </p>
          </div>

          <div class="col-md-4 form-group">
            <label for="modelName">Confidence</label>
            <input name="rules[][confidence]" type="text" class="form-control" value="1">
            <p class="help-block">
              Indicates the confidence of the rule.
            </p>
          </div>

          <div class="col-md-4 form-group">
            <label for="modelName">Weight</label>
            <input name="rules[][weight]" type="text" class="form-control" value="1">
            <p class="help-block">
              Indicates the relative importance of the rule. May or may not be
              equal to the confidence.
            </p>
          </div>
        </div>

        <h4>Predicate</h4>
        <div id="builder"></div>

          </div>
        </div>


        <h1>PMML</h1>
        <button type="button" class="btn btn-primary btn-lg" onClick="generate();">Generate PMML</button>
        
        <p></p>
        <div class="highlight">
          <pre id="pmml" class="prettyprint linenums">...</pre>
        </div>
      </div>

    </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script src="https://raw.githubusercontent.com/mistic100/jQuery-QueryBuilder/master/dist/query-builder.min.js"></script>
    
    <script type="text/javascript" src="./vkbeautify/vkbeautify.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>

    <script src="./prettify/prettify.js"></script>

    <script src="./pegjs/peg-0.8.0.min.js"></script>

    <script src="./common.js"></script>
    <script src="./generate-pmml.js"></script>
    <script src="./predicate.js"></script>
  </body>
</html>
